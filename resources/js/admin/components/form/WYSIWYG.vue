<template>
  <div class="wysiwyg">
    <div class="mb-2 subtitle-1" v-if="label !== ''">{{ label }}</div>
    <ckeditor :disabled="disabled" :editor="editor" :config="editorConfig" v-model="internalValue" />
    <div class="caption" v-if="hint !== ''">{{ hint }}</div>
    <div class="caption">行間を空けずに改行 : Shift + Enter</div>
    <div class="error--text" v-for="message in errorMessages" :key="message">{{ message }}</div>
  </div>
</template>

<script>
import * as ClassicEditor from 'ckeditor5-build-classic-all-plugin';

const COLOR_SET = {
  colors: [
    'hsl(0,0%,0%)',
    'hsl(0,0%,12.5%)',
    'hsl(0,0%,25%)',
    'hsl(0,0%,37.5%)',
    'hsl(0,0%,50%)',
    'hsl(0,0%,62.50%)',
    'hsl(0,0%,75%)',
    'hsl(0,0%,87.5%)',
    { color: 'hsl(0,0%,100%)', hasBorder: !0 },
    'hsl(0,100%,10%)',
    'hsl(0,100%,20%)',
    'hsl(0,100%,30%)',
    'hsl(0,100%,40%)',
    'hsl(0,100%,50%)',
    'hsl(0,100%,60%)',
    'hsl(0,100%,70%)',
    'hsl(0,100%,80%)',
    { color: 'hsl(0,100%,90%)', hasBorder: !0 },
    'hsl(30,100%,10%)',
    'hsl(30,100%,20%)',
    'hsl(30,100%,30%)',
    'hsl(30,100%,40%)',
    'hsl(30,100%,50%)',
    'hsl(30,100%,60%)',
    'hsl(30,100%,70%)',
    'hsl(30,100%,80%)',
    { color: 'hsl(30,100%,90%)', hasBorder: !0 },
    'hsl(60,100%,10%)',
    'hsl(60,100%,20%)',
    'hsl(60,100%,30%)',
    'hsl(60,100%,40%)',
    'hsl(60,100%,50%)',
    'hsl(60,100%,60%)',
    'hsl(60,100%,70%)',
    'hsl(60,100%,80%)',
    { color: 'hsl(60,100%,90%)', hasBorder: !0 },
    'hsl(90,100%,10%)',
    'hsl(90,100%,20%)',
    'hsl(90,100%,30%)',
    'hsl(90,100%,40%)',
    'hsl(90,100%,50%)',
    'hsl(90,100%,60%)',
    'hsl(90,100%,70%)',
    'hsl(90,100%,80%)',
    { color: 'hsl(90,100%,90%)', hasBorder: !0 },
    'hsl(120,100%,10%)',
    'hsl(120,100%,20%)',
    'hsl(120,100%,30%)',
    'hsl(120,100%,40%)',
    'hsl(120,100%,50%)',
    'hsl(120,100%,60%)',
    'hsl(120,100%,70%)',
    'hsl(120,100%,80%)',
    { color: 'hsl(120,100%,90%)', hasBorder: !0 },
    'hsl(150,100%,10%)',
    'hsl(150,100%,20%)',
    'hsl(150,100%,30%)',
    'hsl(150,100%,40%)',
    'hsl(150,100%,50%)',
    'hsl(150,100%,60%)',
    'hsl(150,100%,70%)',
    'hsl(150,100%,80%)',
    { color: 'hsl(150,100%,90%)', hasBorder: !0 },
    'hsl(180,100%,10%)',
    'hsl(180,100%,20%)',
    'hsl(180,100%,30%)',
    'hsl(180,100%,40%)',
    'hsl(180,100%,50%)',
    'hsl(180,100%,60%)',
    'hsl(180,100%,70%)',
    'hsl(180,100%,80%)',
    { color: 'hsl(180,100%,90%)', hasBorder: !0 },
    'hsl(210,100%,10%)',
    'hsl(210,100%,20%)',
    'hsl(210,100%,30%)',
    'hsl(210,100%,40%)',
    'hsl(210,100%,50%)',
    'hsl(210,100%,60%)',
    'hsl(210,100%,70%)',
    'hsl(210,100%,80%)',
    { color: 'hsl(210,100%,90%)', hasBorder: !0 },
    'hsl(240,100%,10%)',
    'hsl(240,100%,20%)',
    'hsl(240,100%,30%)',
    'hsl(240,100%,40%)',
    'hsl(240,100%,50%)',
    'hsl(240,100%,60%)',
    'hsl(240,100%,70%)',
    'hsl(240,100%,80%)',
    { color: 'hsl(240,100%,90%)', hasBorder: !0 },
    'hsl(270,100%,10%)',
    'hsl(270,100%,20%)',
    'hsl(270,100%,30%)',
    'hsl(270,100%,40%)',
    'hsl(270,100%,50%)',
    'hsl(270,100%,60%)',
    'hsl(270,100%,70%)',
    'hsl(270,100%,80%)',
    { color: 'hsl(270,100%,90%)', hasBorder: !0 },
    'hsl(300,100%,10%)',
    'hsl(300,100%,20%)',
    'hsl(300,100%,30%)',
    'hsl(300,100%,40%)',
    'hsl(300,100%,50%)',
    'hsl(300,100%,60%)',
    'hsl(300,100%,70%)',
    'hsl(300,100%,80%)',
    { color: 'hsl(300,100%,90%)', hasBorder: !0 },
    'hsl(330,100%,10%)',
    'hsl(330,100%,20%)',
    'hsl(330,100%,30%)',
    'hsl(330,100%,40%)',
    'hsl(330,100%,50%)',
    'hsl(330,100%,60%)',
    'hsl(330,100%,70%)',
    'hsl(330,100%,80%)',
    { color: 'hsl(330,100%,90%)', hasBorder: !0 },
  ],
  columns: 9,
  documentColors: 18,
};

export default {
  data: () => ({
    editor: ClassicEditor,
    editorConfig: {
      language: 'ja',
      toolbar: {
        viewportTopOffset: 48,
        items: [
          'heading',
          '|',
          'bold',
          'italic',
          'fontsize',
          'fontcolor',
          'fontbackgroundcolor',
          'alignment',
          'link',
          '|',
          'horizontalLine',
          'bulletedList',
          'numberedList',
          'insertTable',
          'blockQuote',
          '|',
          'imageUpload',
          'mediaEmbed',
          '|',
          'undo',
          'redo',
        ],
      },
      heading: {
        options: [
          { model: 'paragraph', title: '段落', class: 'ck-heading--paragraph' },
          { model: 'heading1', view: 'h3', title: '見出し1', class: 'ck-heading--heading1' },
          { model: 'heading2', view: 'h4', title: '見出し2', class: 'ck-heading--heading2' },
          { model: 'heading3', view: 'h5', title: '見出し3', class: 'ck-heading--heading3' },
        ],
      },
      fontColor: COLOR_SET,
      fontBackgroundColor: COLOR_SET,
      table: {
        contentToolbar: ['tableColumn', 'tableRow', 'mergeTableCells'],
      },
      image: {
        resizeUnit: 'px',
        toolbar: [
          'imageStyle:alignLeft',
          'imageStyle:full',
          'imageStyle:alignRight',
          '|',
          'imageTextAlternative',
        ],
        styles: ['full', 'alignLeft', 'alignRight'],
      },
      link: {
        decorators: {
          addTargetToExternalLinks: {
            mode: 'manual',
            label: '外部リンク',
            attributes: {
              target: '_blank',
              rel: 'noopener noreferrer',
            },
          },
        },
      },
    },
  }),
  props: {
    label: {
      type: String,
      required: false,
      default: '',
    },
    hint: {
      type: String,
      required: false,
      default: '',
    },
    disabled: {
      type: Boolean,
      required: false,
      default: false,
    },
    errorMessages: {
      type: Array,
      required: false,
      default: () => [],
    },
    value: {
      type: [String, Number],
      required: false,
      default: '',
    },
  },
  computed: {
    internalValue: {
      get() {
        return this.value === null ? '' : this.value;
      },
      set(value) {
        if (this.value !== value) this.$emit('input', value);
      },
    },
  },
};
</script>
